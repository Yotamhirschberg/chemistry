<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×¨×’×•×œ ×›×™××™×” ××“×¤×˜×™×‘×™ - ××›×™× ×ª ×‘×Ÿ ×’×•×¨×™×•×Ÿ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="header">
    <h1>××ª×¨ ×ª×¨×’×•×œ ×›×™××™×” ğŸ‘¨â€ğŸ”¬ - ××›×™× ×ª ×‘.×’.</h1>
</div>
<div class="nav-bar">
    <a href="index.html" class="nav-btn active-tab">×ª×¨×’×•×œ ××“×¤×˜×™×‘×™ (×©××œ×•×ª)</a>
    <a href="summaries.html" class="nav-btn">×¡×™×›×•××™× ×•×“×’××™× ×•×™×–×•××œ×™×™×</a>
</div>
    
<div class="game-container">
    <div class="stats-bar">
        <span id="level-display" class="level-badge">×¨××” 1 (××ª×—×™×œ)</span>
        <span>× ×§×•×“×•×ª ×›×œ×œ×™×•×ª: <span id="xp-display">0</span></span>
    </div>

    <div class="mastery-progress">
        <div class="mastery-fill" id="mastery-progress-fill"></div>
        <span class="mastery-text" id="mastery-text">× ×§×•×“×•×ª ×©×œ×™×˜×”: 0/10</span>
    </div>

    <div class="topic-display" id="topic-display">× ×•×©×: ×˜×•×¢×Ÿ...</div>
    
    <div id="question-text" class="question-box">×˜×•×¢×Ÿ ×©××œ×”...</div>
    
    <div class="options-grid" id="options-container">
        </div>

    <div id="feedback-msg"></div>
    <button id="next-btn" onclick="nextQuestion()">×”××©×š</button>
</div>

<script>
    // --- JavaScript Logic (Simplified and cleaner) ---

    const MASTERY_GOAL = 10;
    let currentLevel = 1;
    let userXP = 0;
    let masteryPoints = 0;
    let askedQuestionIds = [];
    let questionBank = [];
    let currentQuestion = {};

    // ×˜×¢×™× ×ª ×‘× ×§ ×”×©××œ×•×ª ××§×•×‘×¥ JSON
    async function loadQuestionBank() {
        try {
            const response = await fetch('questions.json');
            questionBank = await response.json();
            loadQuestion();
        } catch (error) {
            document.getElementById('question-text').innerText = '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×©××œ×•×ª. ×•×“× ×©×§×•×‘×¥ questions.json ×§×™×™× ×•××“×•×™×§.';
            console.error('Error loading questions:', error);
        }
    }

    function getQuestionByLevel(level) {
        // ×× ×¡×” ×œ××¦×•× ×©××œ×•×ª ×‘×¨××” ×”× ×•×›×—×™×ª ×©×œ× × ×©××œ×• ×¢×“×™×™×Ÿ
        let availableQuestions = questionBank.filter(q => 
            q.difficulty === level && !askedQuestionIds.includes(q.id)
        );
        
        // ×× × ×’××¨×• ×”×©××œ×•×ª, ×××¤×¡×™× ××ª ×”×”×™×¡×˜×•×¨×™×” ×•××©×ª××©×™× ×‘×›×œ ×”×©××œ×•×ª ×‘×¨××”
        if (availableQuestions.length === 0) {
            askedQuestionIds = [];
            availableQuestions = questionBank.filter(q => q.difficulty === level);
            if (availableQuestions.length === 0) {
                 return null; // ××™×Ÿ ×©××œ×•×ª ×–××™× ×•×ª
            }
        }
        
        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
        const selectedQuestion = availableQuestions[randomIndex];

        askedQuestionIds.push(selectedQuestion.id);
        
        return selectedQuestion;
    }

    function loadQuestion() {
        if (currentLevel > 3) {
             showSummary(true); 
             return;
        }

        const questionData = getQuestionByLevel(currentLevel);
        if (!questionData) {
            showSummary(false); 
            return;
        }
        
        currentQuestion = questionData;
        
        document.getElementById('question-text').innerText = currentQuestion.question;
        document.getElementById('topic-display').innerText = `× ×•×©×: ${currentQuestion.topic}`;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        currentQuestion.answers.forEach((ans, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = ans;
            btn.onclick = () => checkAnswer(index, btn);
            container.appendChild(btn);
        });

        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-msg').innerHTML = '';
        updateStats();
    }

    function checkAnswer(index, btn) {
        document.querySelectorAll('.option-btn').forEach(b => b.onclick = null);

        if (index === currentQuestion.correct) {
            btn.classList.add('correct');
            document.getElementById('feedback-msg').innerHTML = "<span class='feedback-correct'>×ª×©×•×‘×” × ×›×•× ×”!</span>";
            
            masteryPoints++;
            userXP += currentLevel; 
            
            if (masteryPoints >= MASTERY_GOAL && currentLevel < 3) {
                currentLevel++;
                masteryPoints = 0;
                askedQuestionIds = [];
                document.getElementById('feedback-msg').innerHTML = `<span class='feedback-level-up'>××¦×•×™×™×Ÿ! ×¢×‘×¨×ª ×œ×¨××” ${currentLevel}! ğŸ‰</span>`;
            } else if (masteryPoints >= MASTERY_GOAL && currentLevel === 3) {
                 showSummary(true);
                 return;
            }

        } else {
            btn.classList.add('wrong');
            document.querySelectorAll('.option-btn')[currentQuestion.correct].classList.add('correct');
            document.getElementById('feedback-msg').innerHTML = "<span class='feedback-wrong'>×˜×¢×•×ª. × ×ª×¨×’×œ ×©×•×‘ ×›×“×™ ×œ×‘×¡×¡ ××ª ×”×”×‘× ×” ğŸ§</span>";

            masteryPoints = Math.max(0, masteryPoints - 2);
            
            if (currentLevel > 1 && masteryPoints < MASTERY_GOAL / 2) { 
                currentLevel--; 
                masteryPoints = 0;
                askedQuestionIds = [];
                document.getElementById('feedback-msg').innerHTML += `<span class='feedback-level-down'> ×”×•×—×–×¨×ª ×œ×¨××” ${currentLevel} ×œ×—×™×–×•×§.</span>`;
            }
        }

        document.getElementById('next-btn').style.display = 'inline-block';
        updateStats();
    }

    function updateStats() {
        let levelName = "××ª×—×™×œ";
        if(currentLevel === 2) levelName = "××ª×§×“×";
        if(currentLevel === 3) levelName = "××•××—×”";
        
        document.getElementById('level-display').innerText = `×¨××” ${currentLevel} (${levelName})`;
        document.getElementById('xp-display').innerText = userXP;
        
        const progressPercent = (masteryPoints / MASTERY_GOAL) * 100;
        document.getElementById('mastery-progress-fill').style.width = progressPercent + "%";
        document.getElementById('mastery-text').innerText = `× ×§×•×“×•×ª ×©×œ×™×˜×”: ${masteryPoints}/${MASTERY_GOAL}`;
    }

    function showSummary(completed = false) {
        document.querySelector('.game-container').innerHTML = `
            <h2>${completed ? '×›×œ ×”×›×‘×•×“! ×”×’×¢×ª ×œ×©×œ×™×˜×” ××•×—×œ×˜×ª! ğŸ¥‡' : '×¡×™×™××ª ××ª ×”×©××œ×•×ª ×”×–××™× ×•×ª.'}</h2>
            <p>× ×™×§×•×“ ×›×œ×œ×™ ×©×¦×‘×¨×ª: ${userXP}</p>
            <button onclick="location.reload()" class="next-btn" style="display:inline-block">×”×ª×—×œ ××™××•×Ÿ ×—×“×©</button>
        `;
    }

    loadQuestionBank();

</script>

</body>
</html>
