<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תרגול כימיה אדפטיבי - מכינת בן גוריון</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://web.chemdoodle.com/downloads/ChemDoodleWeb.js"></script> 
</head>
<body>

<div class="header">
    <h1>אתר תרגול כימיה 👨‍🔬 - מכינת ב.ג.</h1>
</div>

<div class="nav-bar">
    <a href="index.html" class="nav-btn active-tab">תרגול אדפטיבי (שאלות)</a>
    <a href="summaries.html" class="nav-btn">סיכומים ודגמים ויזואליים</a>
</div>

<div class="game-container">
    <div class="stats-bar">
        <span id="level-display" class="level-badge">רמה 1 (מתחיל)</span>
        <span>נקודות כלליות: <span id="xp-display">0</span></span>
    </div>

    <div class="mastery-progress">
        <div class="mastery-fill" id="mastery-progress-fill"></div>
        <span class="mastery-text" id="mastery-text">נקודות שליטה: 0/10</span>
    </div>

    <div class="topic-display" id="topic-display">נושא: טוען...</div>
    
    <div id="question-text" class="question-box">טוען שאלה...</div>
    
    <div class="options-grid" id="options-container">
        </div>

    <div id="feedback-msg"></div>
    <button id="next-btn" onclick="nextQuestion()">המשך</button>
</div>

<script>
    // --- JavaScript Logic (Question Bank is EMBEDDED here) ---

    // 1. בנק השאלות המלא - מוטמע ישירות בקובץ ה-HTML
    const questionBank = [
        // --- רמה 1: יסודות ומושגים בסיסיים (מכינה) ---
        {
            "id": 101,
            "topic": "תכונות מחזוריות",
            "difficulty": 1,
            "question": "כאשר אטום מאבד אלקטרון והופך לקטיון, כיצד משתנה הרדיוס היוני שלו?",
            "answers": ["הרדיוס גדל", "הרדיוס נשאר זהה", "הרדיוס קטן, כי הליבה חשופה ומשיכת הגרעין מתחזקת", "הרדיוס גדל, בגלל דחיית האלקטרונים"],
            "correct": 2
        },
        {
            "id": 102,
            "topic": "קשרים וסריגים",
            "difficulty": 1,
            "question": "מהו סוג המבנה של חומר שאינו מוליך חשמל כנוזל או כמוצק, ובעל טמפרטורת היתוך נמוכה?",
            "answers": ["סריג יוני", "סריג מתכתי", "סריג אטומרי", "חומר מולקולרי"],
            "correct": 3
        },
        {
            "id": 103,
            "topic": "קשרים בין-מולקולריים",
            "difficulty": 1,
            "question": "איזו אינטראקציה בין-מולקולרית קיימת **בין כל** המולקולות האפשריות של חומר מולקולרי?",
            "answers": ["קשרי מימן", "אינטראקציות דיפול-דיפול", "כוחות לונדון (דו-קוטב רגעי)", "קשר קוולנטי"],
            "correct": 2
        },
        {
            "id": 104,
            "topic": "קשרים וסריגים",
            "difficulty": 1,
            "question": "איזה תנאי **חובה** נדרש כדי שחומר יוליך חשמל?",
            "answers": ["החלקיקים בעלי מטען ומוצקים", "החלקיקים אינם טעונים אך ניידים", "החלקיקים בעלי מטען וניידים", "החומר קוולנטי"],
            "correct": 2
        },
        {
            "id": 105,
            "topic": "קשרים בין-מולקולריים",
            "difficulty": 1,
            "question": "מהי הקבוצה הפונקציונלית המופיעה בכוהל (Alcohol)?",
            "answers": ["קבוצת אסטר (R-C(O)-OR')", "קבוצת אמין (R-N-H)", "קבוצת קרבוקסיל (R-C(O)OH)", "קבוצת הידרוקסיל (R-OH)"],
            "correct": 3
        },
        // --- רמה 2: יישום כללים ---
        {
            "id": 201,
            "topic": "תכונות מחזוריות",
            "difficulty": 2,
            "question": "נתונים היסודות הבאים: $C, N, O, F$. סדר את היסודות לפי רדיוס אטומי עולה (מהקטן לגדול).",
            "answers": ["$F < O < N < C$", "$C < N < O < F$", "$O < F < N < C$", "$N < O < C < F$"],
            "correct": 0
        },
        {
            "id": 202,
            "topic": "קשרים וסריגים",
            "difficulty": 2,
            "question": "איזו מולקולה מבין הבאות היא קוטבית בעלת גיאומטריה זוויתית?",
            "answers": ["$CO_2$ (קווי)", "$BeCl_2$ (קווי)", "$BF_3$ (משולש מישורי)", "$H_2S$ (זוויתי)"],
            "correct": 3
        },
        {
            "id": 203,
            "topic": "קשרים וסריגים",
            "difficulty": 2,
            "question": "כמה זוגות אלקטרונים לא-קושרים קיימים במולקולת $NH_3$ (אמוניה) סביב האטום המרכזי?",
            "answers": ["0", "1", "2", "3"],
            "correct": 1
        },
        {
            "id": 204,
            "topic": "קשרים בין-מולקולריים",
            "difficulty": 2,
            "question": "מדוע אתנול ($CH_3CH_2OH$) מתמוסס במים באופן טוב מאוד?",
            "answers": ["בגלל שהוא מולקולה לא קוטבית", "כי החלק הפחמימני שלו גדול", "בגלל יכולתו ליצור קשרי מימן עם מולקולות המים", "רק בגלל כוחות לונדון"],
            "correct": 2
        },
        // --- רמה 3: שאלות אתגר ---
        {
            "id": 301,
            "topic": "תכונות מחזוריות",
            "difficulty": 3,
            "question": "מדוע אנרגיית היינון הראשונה של חמצן $(O)$ נמוכה מזו של חנקן $(N)$?",
            "answers": ["חמצן רדיוס גדול יותר", "בגלל דחיית אלקטרונים באורביטל $p$ המאוכלס כפול של חמצן", "חנקן רדיוס קטן יותר", "החמצן הוא מתכת"],
            "correct": 1
        },
        {
            "id": 302,
            "topic": "קשרים וסריגים",
            "difficulty": 3,
            "question": "נתונים החומרים: $LiF, MgO, NaF$. למי מהם צפויה אנרגיית הסריג הגבוהה ביותר (בערך מוחלט)?",
            "answers": ["$LiF$ (היונים הכי קטנים)", "$NaF$ (היונים יוניים ביותר)", "$MgO$ (מטענים +2/-2, ויונים קטנים יחסית)", "$CaO$ (סידן גדול ממגנזיום)"],
            "correct": 2
        }
    ];

    // --- קוד המערכת האדפטיבית (ללא שינוי, השתמשנו בעיצוב מודרני כבר) ---
    
    const MASTERY_GOAL = 10;
    let currentLevel = 1;
    let userXP = 0;
    let masteryPoints = 0;
    let askedQuestionIds = [];
    let currentQuestion = {};

    function getQuestionByLevel(level) {
        let availableQuestions = questionBank.filter(q => 
            q.difficulty === level && !askedQuestionIds.includes(q.id)
        );
        
        if (availableQuestions.length === 0) {
            askedQuestionIds = [];
            availableQuestions = questionBank.filter(q => q.difficulty === level);
            if (availableQuestions.length === 0) {
                 return null;
            }
        }
        
        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
        const selectedQuestion = availableQuestions[randomIndex];

        askedQuestionIds.push(selectedQuestion.id);
        
        return selectedQuestion;
    }

    function loadQuestion() {
        if (currentLevel > 3) {
             showSummary(true); 
             return;
        }

        const questionData = getQuestionByLevel(currentLevel);
        if (!questionData) {
            showSummary(false); 
            return;
        }
        
        currentQuestion = questionData;
        
        document.getElementById('question-text').innerText = currentQuestion.question;
        document.getElementById('topic-display').innerText = `נושא: ${currentQuestion.topic}`;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        currentQuestion.answers.forEach((ans, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = ans;
            btn.onclick = () => checkAnswer(index, btn);
            container.appendChild(btn);
        });

        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-msg').innerHTML = '';
        updateStats();
    }

    function checkAnswer(index, btn) {
        document.querySelectorAll('.option-btn').forEach(b => b.onclick = null);

        if (index === currentQuestion.correct) {
            btn.classList.add('correct');
            document.getElementById('feedback-msg').innerHTML = "<span class='feedback-correct'>תשובה נכונה! 👍</span>";
            
            masteryPoints++;
            userXP += currentLevel; 
            
            if (masteryPoints >= MASTERY_GOAL && currentLevel < 3) {
                currentLevel++;
                masteryPoints = 0;
                askedQuestionIds = [];
                document.getElementById('feedback-msg').innerHTML = `<span class='feedback-level-up'>מצויין! עברת לרמה ${currentLevel}! 🎉</span>`;
            } else if (masteryPoints >= MASTERY_GOAL && currentLevel === 3) {
                 showSummary(true);
                 return;
            }

        } else {
            btn.classList.add('wrong');
            document.querySelectorAll('.option-btn')[currentQuestion.correct].classList.add('correct');
            document.getElementById('feedback-msg').innerHTML = "<span class='feedback-wrong'>טעות, נתרגל שוב כדי לבסס את ההבנה 🧐</span>";

            masteryPoints = Math.max(0, masteryPoints - 2);
            
            if (currentLevel > 1 && masteryPoints < MASTERY_GOAL / 2) { 
                currentLevel--; 
                masteryPoints = 0;
                askedQuestionIds = [];
                document.getElementById('feedback-msg').innerHTML += `<span class='feedback-level-down'> הוחזרת לרמה ${currentLevel} לחיזוק.</span>`;
            }
        }

        document.getElementById('next-btn').style.display = 'inline-block';
        updateStats();
    }

    function updateStats() {
        let levelName = "מתחיל";
        if(currentLevel === 2) levelName = "מתקדם";
        if(currentLevel === 3) levelName = "מומחה";
        
        document.getElementById('level-display').innerText = `רמה ${currentLevel} (${levelName})`;
        document.getElementById('xp-display').innerText = userXP;
        
        const progressPercent = (masteryPoints / MASTERY_GOAL) * 100;
        document.getElementById('mastery-progress-fill').style.width = progressPercent + "%";
        document.getElementById('mastery-text').innerText = `נקודות שליטה: ${masteryPoints}/${MASTERY_GOAL}`;
    }

    function showSummary(completed = false) {
        document.querySelector('.game-container').innerHTML = `
            <h2>${completed ? 'כל הכבוד! הגעת לשליטה מוחלטת! 🥇' : 'סיימת את השאלות הזמינות.'}</h2>
            <p>ניקוד כללי שצברת: ${userXP}</p>
            <button onclick="location.reload()" class="next-btn" style="display:inline-block">התחל אימון חדש</button>
        `;
    }

    loadQuestion(); // מתחילים ישירות, אין צורך ב-fetch

</script>

</body>
</html>
