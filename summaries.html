<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>סיכומים ודגמים - כימיה בן גוריון</title>
  <link rel="stylesheet" href="./style-v2.css" />
  <script src="./3dmol-min.js"></script>

  <style>
    .summary-section{
      background:#ecf0f1; padding:20px; border-radius:8px; margin-bottom:30px;
      text-align:right; border-right:5px solid #e74c3c;
    }
    .summary-section h3{
      color:#2c3e50; border-bottom:1px solid #3498db; padding-bottom:5px;
      margin-top:0; margin-bottom:15px;
    }
    .molecule-display{
      width:100%; max-width:720px; height:420px;   /* קצת יותר גדול כדי “לנשום” */
      margin:20px auto; border:2px solid #3498db; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,0.10);
      position:relative; overflow:hidden; touch-action:none; background:white;
    }
    .mol-overlay{
      position:absolute; top:10px; left:10px; padding:8px 10px; border-radius:10px;
      background:rgba(255,255,255,0.90); border:1px solid rgba(0,0,0,0.10);
      font-weight:800; font-size:14px; z-index:5; user-select:none;
    }
    .sub { vertical-align: sub; font-size: smaller; }

    .mastery-table{ width:100%; border-collapse:collapse; margin-top:15px; font-size:0.95em; }
    .mastery-table th,.mastery-table td{ border:1px solid #ddd; padding:12px; text-align:center; }
    .mastery-table th{ background:#34495e; color:white; font-weight:700; }
  </style>
</head>

<body>
  <div class="header">
    <h1>אתר תרגול כימיה 👨‍🔬 - מכינת <b>בן גוריון</b></h1>
  </div>

  <div class="nav-bar">
    <a href="index.html" class="nav-btn">תרגול אדפטיבי (שאלות)</a>
    <a href="summaries.html" class="nav-btn active-tab">סיכומים ודגמים ויזואליים</a>
  </div>

  <div class="game-container">
    <h2>מבנה מולקולרי וקישור: דגמים אינטראקטיביים</h2>
    <p>הדגמים למטה מאפשרים לכם לסובב ולבחון את המבנה המרחבי של מולקולות מפתח. <b>לחץ וגרור כדי לסובב.</b></p>

    <div class="summary-section">
      <h3>1. מים (H<sub class="sub">2</sub>O): מבנה זוויתי וקוטביות</h3>
      <p>למולקולת המים מבנה זוויתי (104.5°). מבנה א-סימטרי זה הופך אותה לקוטבית ויוצר קשרי מימן חזקים.</p>
      <div id="canvas_water" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>2. מתאן (CH<sub class="sub">4</sub>): מבנה טטראדרי ואי-קוטביות</h3>
      <p>מבנה טטראדרי סימטרי (109.5°). מומנטי הדיפול מתבטלים והמולקולה כולה אינה קוטבית.</p>
      <div id="canvas_methane" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>3. אמוניה (NH<sub class="sub">3</sub>): פירמידה משולשת</h3>
      <p>למולקולה זו גיאומטריה של פירמידה משולשת. זוג אלקטרונים לא-קושרים דוחף את קשרי המימן מטה.</p>
      <div id="canvas_ammonia" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>4. פחמן דו-חמצני (CO<sub class="sub">2</sub>): מבנה קווי</h3>
      <p>למולקולה מבנה קווי (180°). למרות קשרים קוטביים, המשיכות מתבטלות בשל הסימטריה, ולכן אינה קוטבית.</p>
      <div id="canvas_co2" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>5. מימן ציאנידי (HCN): מבנה קווי עם קשר משולש</h3>
      <p>מולקולה קווית (180°) קוטבית מאוד, המכילה קשר משולש בין הפחמן לחנקן.</p>
      <div id="canvas_hcn" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>6. בורון טריפלואוריד (BF<sub class="sub">3</sub>): משולש מישורי</h3>
      <p>מולקולה סימטרית ואי-קוטבית. שלושה אטומים ב־120° סביב אטום מרכזי.</p>
      <div id="canvas_bf3" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>7. מילון מונחים מרכזי</h3>
      <p>טבלה זו מסכמת את הגיאומטריות המרחביות העיקריות והתכונות הקשורות.</p>
      <table class="mastery-table">
        <thead>
          <tr>
            <th>מבנה גיאומטרי</th><th>אזורים דוחים</th><th>זוגות לא-קושרים</th>
            <th>זווית אופיינית</th><th>קוטביות (דוגמה)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>קווי</td><td>2</td><td>0</td><td>180°</td><td>אינה קוטבית (CO<sub class="sub">2</sub>)</td></tr>
          <tr><td>משולש מישורי</td><td>3</td><td>0</td><td>120°</td><td>אינה קוטבית (BF<sub class="sub">3</sub>)</td></tr>
          <tr><td>זוויתית</td><td>3</td><td>1</td><td>&lt;120°</td><td>קוטבית (SO<sub class="sub">2</sub>)</td></tr>
          <tr><td>טטראדרי</td><td>4</td><td>0</td><td>109.5°</td><td>אינה קוטבית (CH<sub class="sub">4</sub>)</td></tr>
          <tr><td>פירמידה משולשת</td><td>4</td><td>1</td><td>107°</td><td>קוטבית (NH<sub class="sub">3</sub>)</td></tr>
          <tr><td>זוויתית (מים)</td><td>4</td><td>2</td><td>104.5°</td><td>קוטבית (H<sub class="sub">2</sub>O)</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // ====== עיצוב/כיול כללי ======
    // חשוב: אתה ביקשת "לא לנפח אטומים" – אז כאן האטומים בגודל סביר,
    // והגדלת התצוגה נעשית בעיקר ע"י zoom(2) בתוך המסגרת.
    const COLORS = {
      H: 0xFFFFFF,
      C: 0x909090,
      O: 0xD32F2F,
      N: 0x3F51B5,
      F: 0x2ECC71,
      B: 0x2ECC71
    };

    // רדיוסים "ויזואליים" מאוזנים (לא ענק), כדי שהקשרים יהיו ברורים
    const RAD = { H: 0.30, C: 0.42, O: 0.44, N: 0.44, F: 0.42, B: 0.44 };
    const BOND_RADIUS = 0.12; // קשר עבה וברור
    const DOUBLE_OFFSET = 0.18; // מרחק בין שני קווי קשר כפול (מעל/מתחת במסך)
    const TRIPLE_OFFSET = 0.22;

    function ensureOverlay(el, text) {
      let o = el.querySelector(".mol-overlay");
      if (!o) {
        o = document.createElement("div");
        o.className = "mol-overlay";
        el.appendChild(o);
      }
      o.textContent = text || "";
      return o;
    }

    // ====== מתמטיקה קטנה ======
    const vsub = (a,b)=>({x:a.x-b.x,y:a.y-b.y,z:a.z-b.z});
    const vadd = (a,b)=>({x:a.x+b.x,y:a.y+b.y,z:a.z+b.z});
    const vmul = (a,s)=>({x:a.x*s,y:a.y*s,z:a.z*s});
    const vdot = (a,b)=>a.x*b.x+a.y*b.y+a.z*b.z;
    const vnorm = (v)=>Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);
    const vunit = (v)=>{ const n=vnorm(v)||1; return {x:v.x/n,y:v.y/n,z:v.z/n}; };

    // ====== ציור ======
    function drawSphere(viewer, atom) {
      viewer.addSphere({
        center: { x: atom.x, y: atom.y, z: atom.z },
        radius: RAD[atom.elem] ?? 0.42,
        color: COLORS[atom.elem] ?? 0xAAAAAA,
        quality: 32
      });
    }

    // כאן אנחנו מבטיחים ש"קשר כפול" יהיה שני קווים אחד מעל השני "במסך"
    // ע"י offset לאורך ציר Y של העולם (ובהתחלה אנחנו מיישרים את המולקולות כך שזה באמת "למעלה/למטה").
    function drawBond(viewer, a, b, order=1) {
      const A = {x:a.x,y:a.y,z:a.z};
      const B = {x:b.x,y:b.y,z:b.z};

      const axis = vunit(vsub(B,A));

      // וקטור "למעלה" קבוע במסך (בעולם): Y.
      // אם bond כמעט מקביל ל-Y, נזוז ב-Z כדי למנוע אפס.
      let up = {x:0,y:1,z:0};
      if (Math.abs(vdot(axis, up)) > 0.92) up = {x:0,y:0,z:1};

      // מייצר offset נקי שמאונך לכיוון הקשר
      const proj = vmul(axis, vdot(axis, up));
      const perp = vunit(vsub(up, proj));

      const cyl = (start, end) => viewer.addCylinder({
        start, end,
        radius: BOND_RADIUS,
        color: 0x222222
      });

      if (order === 1) {
        cyl(A,B);
        return;
      }

      if (order === 2) {
        const o = vmul(perp, DOUBLE_OFFSET);
        cyl(vadd(A,o), vadd(B,o));
        cyl(vsub(A,o), vsub(B,o));
        return;
      }

      if (order === 3) {
        cyl(A,B);
        const o = vmul(perp, TRIPLE_OFFSET);
        cyl(vadd(A,o), vadd(B,o));
        cyl(vsub(A,o), vsub(B,o));
        return;
      }

      cyl(A,B);
    }

    function renderMolecule(elId, { atoms, bonds, overlay }) {
      const el = document.getElementById(elId);
      if (!el) return;

      ensureOverlay(el, "טוען…");

      const viewer = $3Dmol.createViewer(el, {
        backgroundColor: "white",
        defaultcolors: $3Dmol.rasmolColors
      });

      // ציור אטומים וקשרים
      // קודם קשרים ואז אטומים -> האטומים "מכסים" יפה את חיבורי הקשר
      for (const b of bonds) {
        const a1 = atoms[b.a], a2 = atoms[b.b];
        if (a1 && a2) drawBond(viewer, a1, a2, b.order ?? 1);
      }
      for (const a of atoms) drawSphere(viewer, a);

      ensureOverlay(el, overlay);

      viewer.zoomTo();
      viewer.zoom(2.0);     // ✅ "פי 2" גודל בתוך המסגרת
      viewer.render();

      attachControls(el, viewer, { spinAxis: "y", spinSpeed: 0.45 });
    }

    function attachControls(el, viewer, { spinAxis="y", spinSpeed=0.45 } = {}) {
      viewer.spin(spinAxis, spinSpeed);

      // זום עדין (לא קופץ)
      el.addEventListener("wheel", (e) => {
        e.preventDefault();
        const dy = Math.max(-120, Math.min(120, e.deltaY));
        const strength = Math.abs(dy) / 120; // 0..1
        const step = 1 + (0.05 * strength);  // עד 5% לכל "קליק"
        const zoomFactor = dy > 0 ? step : (1 / step);
        viewer.zoom(zoomFactor);
        viewer.render();
      }, { passive: false });

      // עצירת spin בזמן גרירה
      const stopSpin = () => viewer.spin(false);
      el.addEventListener("mousedown", stopSpin);
      el.addEventListener("touchstart", stopSpin, { passive: true });

      // resize יציב
      const ro = new ResizeObserver(() => {
        viewer.resize();
        viewer.render();
      });
      ro.observe(el);
    }

    // ====== בניית מולקולות (גיאומטריה אמיתית, לא "אטום בודד") ======
    // הערה: אנחנו לא תלויים ב-PDB כדי שלא "ייפול" קשרים/מבנה.
    function buildH2O() {
      // Bent ~104.5°, נבנה סביב O במרכז
      const O  = { elem:"O", x:0, y:0, z:0 };
      const r = 1.00; // מרחק O-H (רק לציור)
      const theta = 104.5 * Math.PI/180;
      const H1 = { elem:"H", x: r*Math.cos(theta/2), y: r*Math.sin(theta/2), z: 0 };
      const H2 = { elem:"H", x: r*Math.cos(theta/2), y:-r*Math.sin(theta/2), z: 0 };
      const atoms = [O,H1,H2];
      const bonds = [
        {a:0,b:1,order:1},
        {a:0,b:2,order:1},
      ];
      return { atoms, bonds, overlay:"צורה: זוויתית (Bent) • ∠H–O–H≈104.5°" };
    }

    function buildCO2() {
      // O=C=O קווי לאורך X, כדי שהקשר הכפול "מעל/מתחת" ייצא נכון במסך
      const d = 1.25;
      const O1 = { elem:"O", x:-d, y:0, z:0 };
      const C  = { elem:"C", x: 0, y:0, z:0 };
      const O2 = { elem:"O", x: d, y:0, z:0 };
      const atoms = [O1,C,O2];
      const bonds = [
        {a:0,b:1,order:2},
        {a:1,b:2,order:2},
      ];
      return { atoms, bonds, overlay:"צורה: קווית (Linear) • O=C=O (שני קשרים כפולים)" };
    }

    function buildHCN() {
      // H–C≡N קווי
      const H = { elem:"H", x:-1.55, y:0, z:0 };
      const C = { elem:"C", x: 0.00, y:0, z:0 };
      const N = { elem:"N", x: 1.35, y:0, z:0 };
      const atoms = [H,C,N];
      const bonds = [
        {a:0,b:1,order:1},
        {a:1,b:2,order:3},
      ];
      return { atoms, bonds, overlay:"צורה: קווית (Linear) • קשר משולש C≡N" };
    }

    function buildBF3() {
      // Trigonal planar: 120° במישור XY
      const B = { elem:"B", x:0,y:0,z:0 };
      const r = 1.25;
      const F1 = { elem:"F", x:r, y:0, z:0 };
      const F2 = { elem:"F", x:r*Math.cos(2*Math.PI/3), y:r*Math.sin(2*Math.PI/3), z:0 };
      const F3 = { elem:"F", x:r*Math.cos(4*Math.PI/3), y:r*Math.sin(4*Math.PI/3), z:0 };
      const atoms=[B,F1,F2,F3];
      const bonds=[
        {a:0,b:1,order:1},
        {a:0,b:2,order:1},
        {a:0,b:3,order:1},
      ];
      return { atoms, bonds, overlay:"צורה: משולש מישורי (Trigonal planar) • 120°" };
    }

    function buildCH4() {
      // Tetrahedral אמיתי (תלת מימד): וקטורים (±1,±1,±1)
      const C = { elem:"C", x:0,y:0,z:0 };
      const a = 0.95;
      const dirs = [
        {x: 1,y: 1,z: 1},
        {x: 1,y:-1,z:-1},
        {x:-1,y: 1,z:-1},
        {x:-1,y:-1,z: 1},
      ].map(v => vunit(v));

      const Hs = dirs.map(d => ({ elem:"H", x:a*d.x, y:a*d.y, z:a*d.z }));
      const atoms = [C, ...Hs];
      const bonds = [
        {a:0,b:1,order:1},
        {a:0,b:2,order:1},
        {a:0,b:3,order:1},
        {a:0,b:4,order:1},
      ];
      return { atoms, bonds, overlay:"צורה: טטראדרית (Tetrahedral) • ∠≈109.5°" };
    }

    function buildNH3() {
      // Trigonal pyramidal: 3 H בבסיס + N מעליהם (z>0)
      const N = { elem:"N", x:0,y:0,z:0.35 };
      const r = 1.05;
      const H1 = { elem:"H", x:r, y:0, z:-0.15 };
      const H2 = { elem:"H", x:r*Math.cos(2*Math.PI/3), y:r*Math.sin(2*Math.PI/3), z:-0.15 };
      const H3 = { elem:"H", x:r*Math.cos(4*Math.PI/3), y:r*Math.sin(4*Math.PI/3), z:-0.15 };

      const atoms=[N,H1,H2,H3];
      const bonds=[
        {a:0,b:1,order:1},
        {a:0,b:2,order:1},
        {a:0,b:3,order:1},
      ];
      return { atoms, bonds, overlay:"צורה: פירמידה משולשת (Trigonal pyramidal) • ∠≈107°" };
    }

    window.addEventListener("DOMContentLoaded", () => {
      renderMolecule("canvas_water",   buildH2O());
      renderMolecule("canvas_methane", buildCH4());
      renderMolecule("canvas_ammonia", buildNH3());
      renderMolecule("canvas_co2",     buildCO2());
      renderMolecule("canvas_hcn",     buildHCN());
      renderMolecule("canvas_bf3",     buildBF3());
    });
  </script>
</body>
</html>
