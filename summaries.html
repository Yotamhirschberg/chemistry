<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×¡×™×›×•××™× ×•×“×’××™× - ×›×™××™×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ</title>
  <link rel="stylesheet" href="./style-v2.css" />

  <!-- 3Dmol -->
  <script src="./3dmol-min.js"></script>

  <style>
    .summary-section {
      background-color: #ecf0f1;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: right;
      border-right: 5px solid #e74c3c;
    }

    .summary-section h3 {
      color: #2c3e50;
      border-bottom: 1px solid #3498db;
      padding-bottom: 5px;
      margin-top: 0;
      margin-bottom: 15px;
    }

    .molecule-display {
      width: 100%;
      max-width: 720px;          /* ×§×¦×ª ×™×•×ª×¨ ×¨×—×‘ */
      height: 420px;             /* ×§×¦×ª ×™×•×ª×¨ ×’×‘×•×” */
      margin: 20px auto;
      border: 2px solid #3498db;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      touch-action: none;
      background: white;
    }

    .mol-overlay {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.10);
      font-weight: 800;
      font-size: 14px;
      z-index: 5;
      user-select: none;
    }

    .sub { vertical-align: sub; font-size: smaller; }

    .mastery-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.95em;
    }

    .mastery-table th, .mastery-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }

    .mastery-table th {
      background-color: #34495e;
      color: white;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <!-- ×’×¨×¡×ª ×‘×“×™×§×” ×›×“×™ ×©×ª×“×¢ ×©×–×” × ×˜×¢×Ÿ -->
  <div style="position:fixed;bottom:12px;right:12px;z-index:99999;background:#111;color:#fff;padding:8px 10px;border-radius:10px;font-weight:800">
    summaries âœ… v99
  </div>

  <div class="header">
    <h1>××ª×¨ ×ª×¨×’×•×œ ×›×™××™×” ğŸ‘¨â€ğŸ”¬ - ××›×™× ×ª <b>×‘×Ÿ ×’×•×¨×™×•×Ÿ</b></h1>
  </div>

  <div class="nav-bar">
    <a href="index.html" class="nav-btn">×ª×¨×’×•×œ ××“×¤×˜×™×‘×™ (×©××œ×•×ª)</a>
    <a href="summaries.html" class="nav-btn active-tab">×¡×™×›×•××™× ×•×“×’××™× ×•×™×–×•××œ×™×™×</a>
  </div>

  <div class="game-container">
    <h2>××‘× ×” ××•×œ×§×•×œ×¨×™ ×•×§×™×©×•×¨: ×“×’××™× ××™× ×˜×¨××§×˜×™×‘×™×™×</h2>
    <p>×”×“×’××™× ×œ××˜×” ×××¤×©×¨×™× ×œ×›× ×œ×¡×•×‘×‘ ×•×œ×‘×—×•×Ÿ ××ª ×”××‘× ×” ×”××¨×—×‘×™ ×©×œ ××•×œ×§×•×œ×•×ª ××¤×ª×—. <b>×œ×—×¥ ×•×’×¨×•×¨ ×¢×œ ×”××•×œ×§×•×œ×” ×›×“×™ ×œ×¡×•×‘×‘ ××•×ª×”.</b></p>

    <div class="summary-section">
      <h3>1. ××™× (H<sub class="sub">2</sub>O): ××‘× ×” ×–×•×•×™×ª×™ ×•×§×•×˜×‘×™×•×ª</h3>
      <p>×œ××•×œ×§×•×œ×ª ×”××™× ××‘× ×” ×–×•×•×™×ª×™ (104.5Â°). ××‘× ×” ×-×¡×™××˜×¨×™ ×–×” ×”×•×¤×š ××•×ª×” ×œ×§×•×˜×‘×™×ª ×•×™×•×¦×¨ ×§×©×¨×™ ××™××Ÿ ×—×–×§×™×.</p>
      <div id="canvas_water" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>2. ××ª××Ÿ (CH<sub class="sub">4</sub>): ××‘× ×” ×˜×˜×¨××“×¨×™ ×•××™-×§×•×˜×‘×™×•×ª</h3>
      <p>××‘× ×” ×˜×˜×¨××“×¨×™ ×¡×™××˜×¨×™ (109.5Â°). ××•×× ×˜×™ ×”×“×™×¤×•×œ ××ª×‘×˜×œ×™× ×•×”××•×œ×§×•×œ×” ×›×•×œ×” ××™× ×” ×§×•×˜×‘×™×ª.</p>
      <div id="canvas_methane" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>3. ×××•× ×™×” (NH<sub class="sub">3</sub>): ×¤×™×¨××™×“×” ××©×•×œ×©×ª</h3>
      <p>×œ××•×œ×§×•×œ×” ×–×• ×’×™××•××˜×¨×™×” ×©×œ ×¤×™×¨××™×“×” ××©×•×œ×©×ª. ×–×•×’ ××œ×§×˜×¨×•× ×™× ×œ×-×§×•×©×¨×™× ×“×•×—×£ ××ª ×§×©×¨×™ ×”××™××Ÿ ××˜×”.</p>
      <div id="canvas_ammonia" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>4. ×¤×—××Ÿ ×“×•-×—××¦× ×™ (CO<sub class="sub">2</sub>): ××‘× ×” ×§×•×•×™</h3>
      <p>×œ××•×œ×§×•×œ×” ××‘× ×” ×§×•×•×™ (180Â°). ×œ××¨×•×ª ×§×©×¨×™× ×§×•×˜×‘×™×™×, ×”××©×™×›×•×ª ××ª×‘×˜×œ×•×ª ×‘×©×œ ×”×¡×™××˜×¨×™×” ×”××¨×—×‘×™×ª, ×•×œ×›×Ÿ ×”××•×œ×§×•×œ×” ××™× ×” ×§×•×˜×‘×™×ª.</p>
      <div id="canvas_co2" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>5. ××™××Ÿ ×¦×™×× ×™×“×™ (HCN): ××‘× ×” ×§×•×•×™ ×¢× ×§×©×¨ ××©×•×œ×©</h3>
      <p>××•×œ×§×•×œ×” ×§×•×•×™×ª (180Â°) ×§×•×˜×‘×™×ª ×××•×“, ×”××›×™×œ×” (×‘××•×“×œ) ×§×©×¨ ××©×•×œ×© ×‘×™×Ÿ ×”×¤×—××Ÿ ×œ×—× ×§×Ÿ.</p>
      <div id="canvas_hcn" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>6. ×‘×•×¨×•×Ÿ ×˜×¨×™×¤×œ×•××•×¨×™×“ (BF<sub class="sub">3</sub>): ××©×•×œ×© ××™×©×•×¨×™</h3>
      <p>××•×œ×§×•×œ×” ×¡×™××˜×¨×™×ª ×•××™-×§×•×˜×‘×™×ª ×œ×—×œ×•×˜×™×Ÿ. ×©×œ×•×©×” ××˜×•××™× ×”××—×•×‘×¨×™× ×‘-120Â° ×œ××˜×•× ××¨×›×–×™ (×‘×•×¨×•×Ÿ).</p>
      <div id="canvas_bf3" class="molecule-display"></div>
    </div>

    <div class="summary-section">
      <h3>7. ××™×œ×•×Ÿ ××•× ×—×™× ××¨×›×–×™</h3>
      <p>×˜×‘×œ×” ×–×• ××¡×›××ª ××ª ×”×’×™××•××˜×¨×™×•×ª ×”××¨×—×‘×™×•×ª ×”×¢×™×§×¨×™×•×ª ×•×”×ª×›×•× ×•×ª ×”×§×©×•×¨×•×ª.</p>
      <table class="mastery-table">
        <thead>
          <tr>
            <th>××‘× ×” ×’×™××•××˜×¨×™</th>
            <th>××–×•×¨×™× ×“×•×—×™×</th>
            <th>×–×•×’×•×ª ×œ×-×§×•×©×¨×™×</th>
            <th>×–×•×•×™×ª ××•×¤×™×™× ×™×ª</th>
            <th>×§×•×˜×‘×™×•×ª (×“×•×’××”)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>×§×•×•×™</td><td>2</td><td>0</td><td>180Â°</td><td>××™× ×” ×§×•×˜×‘×™×ª (CO<sub class="sub">2</sub>)</td></tr>
          <tr><td>××©×•×œ×© ××™×©×•×¨×™</td><td>3</td><td>0</td><td>120Â°</td><td>××™× ×” ×§×•×˜×‘×™×ª (BF<sub class="sub">3</sub>)</td></tr>
          <tr><td>×–×•×•×™×ª×™×ª</td><td>3</td><td>1</td><td>&lt; 120Â°</td><td>×§×•×˜×‘×™×ª (SO<sub class="sub">2</sub>)</td></tr>
          <tr><td>×˜×˜×¨××“×¨×™</td><td>4</td><td>0</td><td>109.5Â°</td><td>××™× ×” ×§×•×˜×‘×™×ª (CH<sub class="sub">4</sub>)</td></tr>
          <tr><td>×¤×™×¨××™×“×” ××©×•×œ×©×ª</td><td>4</td><td>1</td><td>107Â°</td><td>×§×•×˜×‘×™×ª (NH<sub class="sub">3</sub>)</td></tr>
          <tr><td>×–×•×•×™×ª×™×ª (××™×)</td><td>4</td><td>2</td><td>104.5Â°</td><td>×§×•×˜×‘×™×ª (H<sub class="sub">2</sub>O)</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // =========================
    // Helpers UI
    // =========================
    function ensureOverlay(el, text) {
      let o = el.querySelector(".mol-overlay");
      if (!o) {
        o = document.createElement("div");
        o.className = "mol-overlay";
        el.appendChild(o);
      }
      o.textContent = text || "";
      return o;
    }

    async function loadText(path) {
      const res = await fetch(path, { cache: "no-store" });
      if (!res.ok) throw new Error(`Failed to fetch ${path} (${res.status})`);
      return await res.text();
    }

    function attachControls(el, viewer, { spinAxis = "y", spinSpeed = 0.45, zoomBoost = 2.0 } = {}) {
      viewer.spin(spinAxis, spinSpeed);

      // ×–×•× ×¢×“×™×Ÿ ×•× ×©×œ×˜
      el.addEventListener("wheel", (e) => {
        e.preventDefault();
        const dy = Math.max(-120, Math.min(120, e.deltaY));
        const strength = Math.abs(dy) / 120;     // 0..1
        const step = 1 + (0.05 * strength);      // ××§×¡' 5% ×œ×›×œ ×’×œ×’×•×œ
        const zoomFactor = dy > 0 ? step : (1 / step);
        viewer.zoom(zoomFactor);
        viewer.render();
      }, { passive: false });

      // ×¢×¦×™×¨×ª ×¡×™×‘×•×‘ ×‘×¢×ª ××™× ×˜×¨××§×¦×™×”
      const stopSpin = () => viewer.spin(false);
      el.addEventListener("mousedown", stopSpin);
      el.addEventListener("touchstart", stopSpin, { passive: true });

      // resize ×™×¦×™×‘
      const ro = new ResizeObserver(() => {
        viewer.resize();
        viewer.render();
      });
      ro.observe(el);

      // ×”×’×“×œ×” ×›×œ×œ×™×ª ×‘×ª×•×š ×”×§× ×‘×¡ (×¤×™ 2 ×‘×¢×¨×š)
      viewer.zoom(zoomBoost);
      viewer.render();
    }

    // =========================
    // Geometry + Rendering
    // =========================
    const ELEM_COLOR = {
      H: 0xffffff,
      C: 0x2b2b2b,
      N: 0x2b4cff,
      O: 0xff2b2b,
      F: 0x31d46b,
      B: 0xffb36a
    };

    // "×¨×“×™×•×¡ ×‘×¡×™×¡" ×œ×¢×™×Ÿ (×œ× ×¤×™×–×™×§×œ×™ ××“×•×™×§) ×•××– ××›×¤×™×œ×™× ×¤×™ 2.5 ×›××• ×©×‘×™×§×©×ª
    const BASE_R = { H: 0.22, C: 0.34, N: 0.34, O: 0.34, F: 0.34, B: 0.34 };
    const ATOM_SCALE = 2.5;

    // ×¢×•×‘×™ ×§×©×¨×™× (×œ× ××§×˜×™× ×™×). ×–×” × ×•×ª×Ÿ "×‘×¨×•×¨ ×‘×¢×™×Ÿ" ××‘×œ ×œ× × ×”×™×” ×’×•×©.
    const BOND_R_SINGLE = 0.10;
    const BOND_R_MULTI  = 0.085; // ×œ×§×©×¨ ×›×¤×•×œ/××©×•×œ×© (×©× ×™/×©×œ×•×©×” ×§×•×•×™×) ×§×¦×ª ×“×§ ×™×•×ª×¨ ×›×“×™ ×©×™×¨××• ×§×•×•×™× × ×¤×¨×“×™×

    // ××¨×—×§ ×”×”×¡×˜×” ×‘×™×Ÿ ×§×•×•×™× ×‘×§×©×¨ ×›×¤×•×œ/××©×•×œ×©
    const MULTI_OFFSET = 0.16;

    function vsub(a,b){return {x:a.x-b.x,y:a.y-b.y,z:a.z-b.z};}
    function vadd(a,b){return {x:a.x+b.x,y:a.y+b.y,z:a.z+b.z};}
    function vmul(a,s){return {x:a.x*s,y:a.y*s,z:a.z*s};}
    function vdot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z;}
    function vnorm(v){return Math.sqrt(vdot(v,v));}
    function vunit(v){const n=vnorm(v)||1; return {x:v.x/n,y:v.y/n,z:v.z/n};}
    function vcross(a,b){return {x:a.y*b.z-a.z*b.y,y:a.z*b.x-a.x*b.z,z:a.x*b.y-a.y*b.x};}

    function parsePDBAtoms(pdbText) {
      const atoms = [];
      const lines = pdbText.split(/\r?\n/);
      for (const line of lines) {
        if (!line.startsWith("ATOM") && !line.startsWith("HETATM")) continue;
        const x = parseFloat(line.slice(30,38));
        const y = parseFloat(line.slice(38,46));
        const z = parseFloat(line.slice(46,54));
        // ××œ×× ×˜: ××• ×‘×¢××•×“×•×ª 77-78 ××• ××ª×•×š ×©× ×”××˜×•×
        let elem = (line.slice(76,78) || "").trim();
        if (!elem) {
          const name = (line.slice(12,16) || "").trim();
          elem = name.replace(/[0-9]/g,"").slice(0,2);
        }
        elem = elem.charAt(0).toUpperCase() + (elem.charAt(1)||"").toLowerCase();
        // × ×•×¨××œ×™×–×¦×™×” ×œ-H/C/N/O/F/B
        elem = elem.toUpperCase();
        atoms.push({ elem, x, y, z });
      }
      return atoms;
    }

    // === ××™×“××œ×™×–×¦×™×” ×œ×ª×œ×ª-×××“ ×××™×ª×™ (×’× ×× ×”-PDB ×©×˜×•×—) ===
    // ××—×–×™×¨ ××˜×•××™× + ×§×©×¨×™× ×¢× order (1/2/3)
    function buildIdealMolecule(key, pdbAtoms) {
      // × ×©×ª××© ×‘×”×¨×›×‘ ××”-P
